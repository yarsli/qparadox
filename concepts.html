<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QParadox • Concepts Atlas</title>

<!-- Fonts + MathJax -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"/>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>
:root{
  --bg:#0b0b0d; --panel:#131316; --ink:#efeae2; --ink2:#d8d1c8; --muted:#b9b3aa;
  --gold:#caa36b; --blue:#7aa0ff; --line:rgba(255,255,255,.14); --glass:rgba(255,255,255,.06);
  --shadow:0 18px 60px rgba(0,0,0,.72), inset 0 0 120px rgba(255,255,255,.03);
  --radius:18px; --side:360px; --maxw:1240px; --navh:64px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:"Crimson Text",serif; line-height:1.95; letter-spacing:.15px; overflow-x:hidden;
}
body::before{content:""; position:fixed; inset:0; z-index:-3; opacity:.06;
  background:url('https://www.transparenttextures.com/patterns/asfalt-dark.png')}
body::after{content:""; position:fixed; inset:0; z-index:-2;
  background:
    radial-gradient(1000px 620px at 12% -10%, rgba(255,222,180,.10), transparent 60%),
    radial-gradient(1000px 620px at 88% 0%, rgba(140,160,255,.08), transparent 60%),
    radial-gradient(1200px 720px at 50% 110%, rgba(202,163,107,.10), transparent 72%)}
.frame{position:fixed; inset:18px; border:1px solid var(--line); border-radius:22px; pointer-events:none; box-shadow:inset 0 0 140px rgba(0,0,0,.45)}
#progress{position:fixed; top:0; left:0; height:4px; width:0; z-index:100; background:linear-gradient(90deg,var(--gold),var(--blue))}

/* Top nav + hamburger */
.topnav{
  position:sticky; top:0; z-index:50; height:var(--navh);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 12px;
  background:linear-gradient(180deg, rgba(11,11,13,.96), rgba(11,11,13,.75));
  border-bottom:1px solid var(--line); backdrop-filter:blur(6px)
}
.brand{display:flex; align-items:center; gap:.6rem}
.brand b{font-family:"Playfair Display",serif; font-size:1.2rem; color:#f5ead8}
.brand small{color:var(--ink2)}
.hamb{display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:10px;
  border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer}
.hamb:hover{border-color:rgba(255,255,255,.28)}
.toplinks a{color:var(--ink2); text-decoration:none; margin:0 .4rem; border-bottom:1px dotted rgba(255,255,255,.25)}
.toplinks a:hover{color:#fff}

/* Side drawer */
.drawer{position:fixed; inset:0; z-index:60; display:none}
.drawer.open{display:block}
.drawer .shade{position:absolute; inset:0; background:rgba(0,0,0,.5)}
.drawer .panel{
  position:absolute; left:0; top:0; height:100%; width:min(86vw,420px);
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
  border-right:1px solid var(--line); box-shadow:var(--shadow); padding:14px
}
.panel h3{margin:.2rem 0 .6rem; font-family:"Playfair Display",serif}
.panel a{display:block; color:var(--ink); text-decoration:none; padding:.4rem .2rem; border-radius:.4rem}
.panel a:hover{background:rgba(255,255,255,.06)}
.panel .fav{margin-top:.6rem; border-top:1px solid var(--line); padding-top:.6rem}
.closex{position:absolute; right:10px; top:10px; width:34px; height:34px; border:1px solid var(--line); border-radius:10px; background:var(--glass); color:var(--ink); cursor:pointer}

/* Header */
header{padding:2.2rem 1.2rem 1.2rem; text-align:center}
h1{font-family:"Playfair Display",serif; font-weight:900; margin:.4rem 0 0; font-size:clamp(2.4rem,4vw,4.5rem); line-height:1.1; color:#f5ead8}
.subtitle{max-width:980px; margin:.6rem auto 0; color:var(--ink2); font-size:clamp(1.05rem,1.2vw,1.2rem)}
.badge{display:inline-block; font-size:.85rem; padding:.18rem .55rem; border:1px solid var(--line); border-radius:.5rem; background:rgba(255,255,255,.06); color:var(--ink2); margin:.2rem .2rem 0}

/* Controls */
.controls{width:min(var(--maxw),94%); margin:0 auto 1.2rem; display:grid; gap:.8rem}
@media(min-width:980px){ .controls{grid-template-columns:1.4fr .9fr .9fr} }
.ctrlBox{
  border:1px solid var(--line); border-radius:14px; background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  box-shadow:var(--shadow); padding:.8rem .9rem
}
.ctrlBox h3{margin:.2rem 0 .6rem; font-family:"Playfair Display",serif; font-size:1.15rem; color:#f6eddc}
.search{display:flex; gap:.6rem}
.search input{
  flex:1; background:rgba(255,255,255,.05); border:1px solid var(--line); color:var(--ink);
  border-radius:.6rem; padding:.6rem .7rem
}
.search button{
  border:1px solid var(--line); background:var(--glass); color:var(--ink); border-radius:.6rem; padding:.55rem .8rem; cursor:pointer
}
.pills{display:flex; flex-wrap:wrap; gap:.45rem}
.pill{
  padding:.28rem .6rem; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,.05); color:var(--ink2);
  cursor:pointer; user-select:none; font-size:.92rem
}
.pill.active{color:#111; background:linear-gradient(90deg,var(--gold),#efd6a8)}
.small{font-size:.86rem; color:var(--muted)}

/* Alpha bar */
.alpha{
  position:sticky; top:var(--navh); z-index:5;
  display:flex; flex-wrap:wrap; gap:.25rem .35rem; align-items:center;
  background:linear-gradient(180deg,rgba(11,11,13,.92),rgba(11,11,13,.72));
  border:1px solid var(--line); border-left:none; border-right:none;
  padding:.35rem .6rem; backdrop-filter:blur(6px)
}
.alpha b{color:#d6c6a8; margin-right:.4rem}
.alpha button{
  border:1px solid var(--line); background:rgba(255,255,255,.05); color:var(--ink2);
  border-radius:.4rem; font-size:.82rem; padding:.15rem .4rem; cursor:pointer
}
.alpha button:hover{color:#fff}

/* Main layout */
.main{width:min(var(--maxw),94%); margin:0 auto 3rem; display:grid; grid-template-columns:1fr; gap:26px}
@media(min-width:1200px){ .main{grid-template-columns:minmax(0,1fr) var(--side)} }

article{
  background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:1.2rem 1.1rem
}
section.group{margin-top:1rem; border:1px solid var(--line); border-radius:16px; overflow:hidden}
.group header.secHead{
  display:flex; align-items:center; justify-content:space-between; gap:1rem;
  background:rgba(255,255,255,.04); padding:.8rem 1rem; cursor:pointer
}
.group h2{
  font-family:"Playfair Display",serif; margin:0; font-size:clamp(1.5rem,2.2vw,2.1rem); color:#f6eddc
}
.group .count{color:var(--muted); font-size:.9rem}
.group .grid{display:grid; gap:14px; padding:1rem; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); border-top:1px solid var(--line)}
.group.collapsed .grid{display:none}

.card{
  position:relative;
  border:1px solid var(--line); border-radius:16px;
  background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  box-shadow:var(--shadow);
  padding:1rem .95rem 1.05rem;
  transition:transform .18s ease, border-color .18s ease;
}
.card:hover{transform:translateY(-2px); border-color:rgba(255,255,255,.28)}
.card h4{
  display:flex; align-items:center; gap:.5rem;
  margin:.2rem 0 .45rem; font-size:1.15rem; color:#f7edde; font-family:"Playfair Display",serif
}
.card .meta{display:flex; gap:.45rem; flex-wrap:wrap; margin:.2rem 0 .55rem}
.tag{font-size:.78rem; color:#111; background:linear-gradient(90deg,var(--gold),#efd6a8); padding:.15rem .5rem; border-radius:.5rem}
.tag.alt{background:linear-gradient(90deg,rgba(122,160,255,.75),rgba(202,163,107,.7)); color:#0c0c10}
.card p{margin:.5rem 0}
.card .eq{margin:.45rem 0 .2rem; color:#e9e1d6}
.card .links{display:flex; gap:.45rem; flex-wrap:wrap; margin-top:.6rem}
.card a{color:#d9d1c6; text-decoration:none; border-bottom:1px dotted rgba(255,255,255,.25)}
.card a:hover{color:#fff}
.star{
  position:absolute; right:.5rem; top:.5rem; border:1px solid var(--line); border-radius:.6rem;
  background:var(--glass); color:var(--ink); font-size:.9rem; padding:.2rem .5rem; cursor:pointer
}
.star.active{background:linear-gradient(90deg,var(--gold),#efd6a8); color:#111}

hr.sep{border:0; height:1px; background:linear-gradient(90deg,transparent,var(--line),transparent); margin:1.2rem 0}

aside{
  position:sticky; top:calc(var(--navh) + 24px); align-self:start; height:fit-content;
  background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); padding:1rem .9rem
}
aside h3{margin:.2rem 0 .6rem; font-family:"Playfair Display",serif}
aside .note{border:1px solid var(--line); border-radius:12px; padding:.6rem .7rem; margin:.5rem 0; background:rgba(255,255,255,.05)}
aside time{display:block; color:var(--muted); font-size:.85rem}
aside .del{margin-top:.4rem; padding:.25rem .55rem; border-radius:.5rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer}
aside .tips{color:var(--ink2); font-size:.95rem}

footer{padding:2rem 1rem; text-align:center; color:var(--muted); border-top:1px solid var(--line)}
.reveal{opacity:0; transform:translateY(24px); transition:opacity .9s, transform .9s}
.reveal.in{opacity:1; transform:none}

/* Back-to-top */
#toTop{
  position:fixed; right:18px; bottom:18px; z-index:40; display:none;
  border:1px solid var(--line); background:var(--glass); color:var(--ink); border-radius:10px; padding:.55rem .8rem; cursor:pointer
}
#toTop.show{display:block}
</style>
</head>
<body>

<div class="frame" aria-hidden="true"></div>
<div id="progress"></div>

<!-- Top nav -->
<div class="topnav">
  <button class="hamb" id="openDrawer" aria-label="Open menu">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
  </button>
  <div class="brand">
    <b>QParadox</b><small>Concepts Atlas</small>
  </div>
  <div class="toplinks">
    <a href="index.html">Home</a>
    <a href="introduction.html">Introduction</a>
    <a href="theoretical.html">Theoretical</a>
    <a href="experimental.html">Experimental</a>
    <a href="computational.html">Computational</a>
  </div>
</div>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div class="shade" id="closeDrawer"></div>
  <div class="panel">
    <button class="closex" id="closeDrawerBtn" aria-label="Close menu">✕</button>
    <h3>Navigate</h3>
    <a href="index.html">Home</a>
    <a href="introduction.html">New to QParadox</a>
    <a href="domains.html">Domains Overview</a>
    <a href="theoretical.html">Theoretical Hub</a>
    <a href="experimental.html">Experimental Hub</a>
    <a href="computational.html">Computational Hub</a>
    <a href="concepts.html"><b>Concepts Atlas</b></a>
    <div class="fav">
      <h3>⭐ Pinned concepts</h3>
      <div id="favLinks" class="small" style="color:var(--ink2)">No favorites yet. Click ★ on any card.</div>
    </div>
  </div>
</div>

<header class="reveal in">
  <h1>Concepts Atlas</h1>
  <p class="subtitle">
    Everything in one place — filter by field or method, search by name, or jump A–Z.
    <span class="badge">Dark academia</span>
    <span class="badge">Maximalist</span>
    <span class="badge">MathJax ready</span>
  </p>
</header>

<!-- Controls -->
<div class="controls reveal">
  <div class="ctrlBox">
    <h3>Search concepts</h3>
    <div class="search">
      <input id="qsearch" type="text" placeholder="Type a concept, formula, or keyword… e.g. Noether, tunneling, Maxwell, partition function"/>
      <button id="clearBtn">Clear</button>
    </div>
    <div class="small" id="countLine" style="margin-top:.45rem">Showing all concepts</div>
  </div>

  <div class="ctrlBox">
    <h3>Filter by domain</h3>
    <div class="pills" id="domainPills">
      <span class="pill active" data-domain="all">All</span>
      <span class="pill" data-domain="classical">Classical</span>
      <span class="pill" data-domain="em">Electromagnetism</span>
      <span class="pill" data-domain="quantum">Quantum</span>
      <span class="pill" data-domain="relativity">Relativity</span>
      <span class="pill" data-domain="thermo">Thermo & Stat</span>
      <span class="pill" data-domain="optics">Optics & Waves</span>
      <span class="pill" data-domain="condensed">Condensed</span>
      <span class="pill" data-domain="particle">Particle & Field</span>
      <span class="pill" data-domain="cosmo">Cosmology & Astro</span>
      <span class="pill" data-domain="methods">Methods</span>
      <span class="pill" data-domain="meta">Metaphysics & Philosophy</span>
    </div>
  </div>

  <div class="ctrlBox">
    <h3>Filter by method</h3>
    <div class="pills" id="methodPills">
      <span class="pill active" data-method="any">Any</span>
      <span class="pill" data-method="theory">Theory</span>
      <span class="pill" data-method="experiment">Experiment</span>
      <span class="pill" data-method="compute">Computation</span>
    </div>
    <div class="small" style="margin-top:.55rem">
      <button id="expandAll" style="border:1px solid var(--line); background:var(--glass); color:var(--ink); border-radius:.6rem; padding:.35rem .55rem; cursor:pointer">Expand all</button>
      <button id="collapseAll" style="border:1px solid var(--line); background:var(--glass); color:var(--ink); border-radius:.6rem; padding:.35rem .55rem; cursor:pointer">Collapse all</button>
    </div>
  </div>
</div>

<!-- Alphabet jumper -->
<div class="alpha reveal"><b>A–Z</b><div id="alphaButtons"></div></div>

<div class="main">
  <article id="article" class="reveal">

    <!-- Sections -->
    <section class="group" id="sec-classical">
      <header class="secHead" data-toggle="sec-classical"><h2>Classical Mechanics</h2><span class="count" id="cnt-classical"></span></header>
      <div class="grid" data-domain="classical"></div>
    </section>

    <section class="group" id="sec-em">
      <header class="secHead" data-toggle="sec-em"><h2>Electromagnetism</h2><span class="count" id="cnt-em"></span></header>
      <div class="grid" data-domain="em"></div>
    </section>

    <section class="group" id="sec-quantum">
      <header class="secHead" data-toggle="sec-quantum"><h2>Quantum Mechanics</h2><span class="count" id="cnt-quantum"></span></header>
      <div class="grid" data-domain="quantum"></div>
    </section>

    <section class="group" id="sec-relativity">
      <header class="secHead" data-toggle="sec-relativity"><h2>Relativity</h2><span class="count" id="cnt-relativity"></span></header>
      <div class="grid" data-domain="relativity"></div>
    </section>

    <section class="group" id="sec-thermo">
      <header class="secHead" data-toggle="sec-thermo"><h2>Thermodynamics & Statistical Mechanics</h2><span class="count" id="cnt-thermo"></span></header>
      <div class="grid" data-domain="thermo"></div>
    </section>

    <section class="group" id="sec-optics">
      <header class="secHead" data-toggle="sec-optics"><h2>Optics & Waves</h2><span class="count" id="cnt-optics"></span></header>
      <div class="grid" data-domain="optics"></div>
    </section>

    <section class="group" id="sec-condensed">
      <header class="secHead" data-toggle="sec-condensed"><h2>Condensed Matter</h2><span class="count" id="cnt-condensed"></span></header>
      <div class="grid" data-domain="condensed"></div>
    </section>

    <section class="group" id="sec-particle">
      <header class="secHead" data-toggle="sec-particle"><h2>Particle & Field Theory</h2><span class="count" id="cnt-particle"></span></header>
      <div class="grid" data-domain="particle"></div>
    </section>

    <section class="group" id="sec-cosmo">
      <header class="secHead" data-toggle="sec-cosmo"><h2>Cosmology & Astrophysics</h2><span class="count" id="cnt-cosmo"></span></header>
      <div class="grid" data-domain="cosmo"></div>
    </section>

    <section class="group" id="sec-methods">
      <header class="secHead" data-toggle="sec-methods"><h2>Cross-Cutting Methods (Theory • Experiment • Computation)</h2><span class="count" id="cnt-methods"></span></header>
      <div class="grid" data-domain="methods"></div>
    </section>

    <section class="group" id="sec-meta">
      <header class="secHead" data-toggle="sec-meta"><h2>Metaphysics & Philosophy of Physics</h2><span class="count" id="cnt-meta"></span></header>
      <div class="grid" data-domain="meta"></div>
    </section>

    <hr class="sep"/>

    <!-- Quick nav row at bottom -->
    <div class="alpha" style="border-radius:12px; margin-bottom:.6rem">
      <b>Navigation</b>
      <button onclick="location.href='index.html'">Home</button>
      <button onclick="location.href='introduction.html'">Introduction</button>
      <button onclick="location.href='theoretical.html'">Theoretical Hub</button>
      <button onclick="location.href='experimental.html'">Experimental Hub</button>
      <button onclick="location.href='computational.html'">Computational Hub</button>
      <button onclick="location.href='domains.html'">Domains</button>
    </div>

  </article>

  <!-- Sidebar -->
  <aside class="reveal">
    <h3>Notebook</h3>
    <p class="tips">Press ★ on any concept card to pin it here. Add your own note below.</p>
    <div id="nbList"></div>
    <textarea id="freeNote" placeholder="Write your own note. Press Save." style="width:100%; height:110px; background:rgba(255,255,255,.05); border:1px solid var(--line); color:var(--ink); border-radius:.5rem; padding:.55rem .6rem; font-family:'Crimson Text',serif;"></textarea>
    <div style="display:flex; gap:.5rem; margin-top:.4rem">
      <button id="saveFree" style="padding:.45rem .7rem; border-radius:.6rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer">Save</button>
      <button id="clearAll" style="padding:.45rem .7rem; border-radius:.6rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer">Clear all</button>
    </div>
    <p class="small" style="margin-top:.4rem">Notes are saved in this browser only.</p>

    <h3 style="margin-top:1rem">Tips</h3>
    <div class="note">
      <time>Pro tip</time>
      <p>Combine filters. Example: <em>Quantum</em> + <em>Experiment</em> shows Bell, HOM, Josephson, etc.</p>
    </div>
    <div class="note">
      <time>Math</time>
      <p>Inline math \(E=hf\) and blocks render with MathJax.</p>
    </div>
  </aside>
</div>

<footer>© 2025 QParadox • Concepts Atlas</footer>
<button id="toTop" title="Back to top">↑ Top</button>

<script>
/* progress bar + back-to-top */
const bar=document.getElementById('progress'), toTop=document.getElementById('toTop');
function onScroll(){
  const h=document.documentElement, st=h.scrollTop||document.body.scrollTop, sh=h.scrollHeight-h.clientHeight;
  bar.style.width=(Math.max(0,Math.min(1,st/sh))*100)+'%';
  toTop.classList.toggle('show', st>600);
}
addEventListener('scroll', onScroll); onScroll();
toTop.addEventListener('click', ()=>scrollTo({top:0, behavior:'smooth'}));

/* reveal */
const obs=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('in'); obs.unobserve(e.target);} }); },{threshold:.18});
document.querySelectorAll('.reveal').forEach(el=>{ if(!el.classList.contains('in')) obs.observe(el); });

/* drawer */
const drawer=document.getElementById('drawer');
document.getElementById('openDrawer').onclick=()=>drawer.classList.add('open');
document.getElementById('closeDrawer').onclick=()=>drawer.classList.remove('open');
document.getElementById('closeDrawerBtn').onclick=()=>drawer.classList.remove('open');

/* filters */
let activeDomain='all', activeMethod='any', query='';
const domainPills=document.getElementById('domainPills');
const methodPills=document.getElementById('methodPills');
domainPills.addEventListener('click',e=>{
  const t=e.target.closest('.pill'); if(!t) return;
  domainPills.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); t.classList.add('active');
  activeDomain=t.dataset.domain; render();
});
methodPills.addEventListener('click',e=>{
  const t=e.target.closest('.pill'); if(!t) return;
  methodPills.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); t.classList.add('active');
  activeMethod=t.dataset.method; render();
});
document.getElementById('qsearch').addEventListener('input',e=>{ query=e.target.value.toLowerCase(); render(); });
document.getElementById('clearBtn').onclick=()=>{ document.getElementById('qsearch').value=''; query=''; render(); };

/* accordion toggles + expand/collapse all */
document.querySelectorAll('.secHead').forEach(h=>{
  h.addEventListener('click',()=>{
    const id=h.dataset.toggle; document.getElementById(id).classList.toggle('collapsed');
  });
});
document.getElementById('expandAll').onclick=()=>document.querySelectorAll('.group').forEach(g=>g.classList.remove('collapsed'));
document.getElementById('collapseAll').onclick=()=>document.querySelectorAll('.group').forEach(g=>g.classList.add('collapsed'));

/* favorites + notebook */
const KEY_FAV='qpx_concepts_fav_v2', KEY_NOTE='qpx_concepts_notes_v1';
function loadFav(){ try{return JSON.parse(localStorage.getItem(KEY_FAV)||'[]');}catch(e){return [];} }
function saveFav(arr){ localStorage.setItem(KEY_FAV, JSON.stringify(arr)); }
function loadNote(){ try{return JSON.parse(localStorage.getItem(KEY_NOTE)||'[]');}catch(e){return [];} }
function saveNote(arr){ localStorage.setItem(KEY_NOTE, JSON.stringify(arr)); }
function renderFavLinks(){
  const fav=loadFav(); const box=document.getElementById('favLinks');
  if(fav.length===0){ box.textContent='No favorites yet. Click ★ on any card.'; return; }
  box.innerHTML=''; fav.forEach(id=>{
    const item=data.find(d=>d.id===id); if(!item) return;
    const a=document.createElement('a'); a.href=item.href; a.textContent=item.title; a.style.display='block';
    box.appendChild(a);
  });
}
const nbList=document.getElementById('nbList');
function renderNotes(){
  const notes=loadNote(); nbList.innerHTML='';
  if(notes.length===0){ nbList.innerHTML='<p class="small" style="color:var(--muted)">No notes yet.</p>'; return; }
  notes.forEach(n=>{
    const div=document.createElement('div'); div.className='note'; div.dataset.id=n.id;
    div.innerHTML=`<time>${new Date(n.time).toLocaleString()}</time><p>${n.text}</p><button class="del">Remove</button>`;
    nbList.appendChild(div);
  });
}
document.getElementById('saveFree').onclick=()=>{
  const box=document.getElementById('freeNote'); const t=box.value.trim(); if(!t) return;
  const arr=loadNote(); arr.push({id:'n'+Date.now(), text:t, time:Date.now()}); saveNote(arr); renderNotes(); box.value='';
};
document.getElementById('clearAll').onclick=()=>{
  if(!confirm('Clear all saved notes for this page')) return;
  localStorage.removeItem(KEY_NOTE); renderNotes();
};
nbList.addEventListener('click',e=>{
  if(!e.target.classList.contains('del')) return;
  const id = e.target.closest('.note').dataset.id;
  const arr = loadNote().filter(n=>n.id!==id); saveNote(arr); renderNotes();
});

/* A–Z */
const alphaWrap=document.getElementById('alphaButtons');
function makeAlphaButtons(letters){
  alphaWrap.innerHTML='';
  [...letters].sort().forEach(L=>{
    const b=document.createElement('button'); b.textContent=L;
    b.onclick=()=>{
      const el=document.querySelector(`[data-letter="${L}"]`); if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    };
    alphaWrap.appendChild(b);
  });
}

/* =============== DATASET (with Metaphysics added) =============== */
const data = [
  /* CLASSICAL */
  {id:'c-newton', title:"Newton's Laws", domain:'classical', method:'theory', href:'newton-laws.html', eq:'\\(\\vec{F}_{\\text{net}}=d\\vec{p}/dt\\)', blurb:'Match net external force to momentum change. Always declare a boundary.'},
  {id:'c-work', title:'Work & Energy', domain:'classical', method:'theory', href:'work-energy.html', eq:'\\(\\Delta K=W_{\\text{net}}\\)', blurb:'Convert forces along a path into energy changes. Decide what becomes heat.'},
  {id:'c-lagrange', title:'Lagrangian Mechanics', domain:'classical', method:'theory', href:'lagrangian-mechanics.html', eq:'\\(L=T-V\\)', blurb:'Handle constraints via coordinates. Symmetries of the action produce conserved quantities.'},
  {id:'c-hamilton', title:'Hamiltonian Mechanics', domain:'classical', method:'theory', href:'hamiltonian-mechanics.html', eq:'\\(\\dot{q}_i=\\partial H/\\partial p_i\\)', blurb:'Phase-space view with positions and momenta; bridge to quantum structure.'},
  {id:'c-modes', title:'Normal Modes', domain:'classical', method:'theory', href:'normal-modes.html', eq:'\\(\\det|K-\\omega^2M|=0\\)', blurb:'Diagonalize coupled oscillators into clean patterns that do not mix.'},
  {id:'c-central', title:'Central Forces & Orbits', domain:'classical', method:'theory', href:'central-forces-orbits.html', eq:'\\(V_{\\text{eff}}=V(r)+\\ell^2/2mr^2\\)', blurb:'One effective potential reveals stability, turning points, and orbit classes.'},
  {id:'c-rigidbody', title:'Rigid Body Dynamics', domain:'classical', method:'theory', href:'rigid-body.html', eq:'\\(\\vec{\\tau}=I\\vec{\\alpha}\\)', blurb:'Moments of inertia, torque, and precession; body frames clarify motion.'},
  {id:'c-chaos', title:'Chaos & Poincaré Maps', domain:'classical', method:'compute', href:'chaos-poincare.html', eq:'\\(|\\delta x(t)|\\sim e^{\\lambda t}|\\delta x_0|\\)', blurb:'Sensitivity to initial conditions; visualize with sections and Lyapunov exponents.'},
  {id:'c-continuum', title:'Continuum Mechanics', domain:'classical', method:'theory', href:'continuum-mechanics.html', eq:'\\(\\partial_t\\rho+\\nabla\\cdot(\\rho\\vec{v})=0\\)', blurb:'Fluids and elastic media built from conservation laws.'},

  /* EM */
  {id:'e-maxwell', title:"Maxwell's Equations", domain:'em', method:'theory', href:'maxwells-equations.html', eq:'\\(\\nabla\\cdot\\vec{E}=\\rho/\\varepsilon_0,\\,\\nabla\\cdot\\vec{B}=0,\\,\\nabla\\times\\vec{E}=-\\partial_t\\vec{B},\\,\\nabla\\times\\vec{B}=\\mu_0\\vec{J}+\\mu_0\\varepsilon_0\\partial_t\\vec{E}\\)', blurb:'Unifies electricity, magnetism, and light; predicts wave speed.'},
  {id:'e-potentials', title:'Potentials & Gauge', domain:'em', method:'theory', href:'potentials-gauge.html', eq:'\\(\\vec{B}=\\nabla\\times\\vec{A},\\ \\vec{E}=-\\nabla\\phi-\\partial_t\\vec{A}\\)', blurb:'Choose gauges to simplify problems; symmetry viewpoint extends to QFT.'},
  {id:'e-poynting', title:'Poynting Vector', domain:'em', method:'theory', href:'poynting-vector.html', eq:'\\(\\vec{S}=\\vec{E}\\times\\vec{H}\\)', blurb:'Track energy flow and power across surfaces in fields.'},
  {id:'e-waves', title:'EM Waves & Polarization', domain:'em', method:'theory', href:'em-waves-polarization.html', eq:'\\(\\nabla^2\\vec{E}-\\mu_0\\varepsilon_0\\partial_t^2\\vec{E}=0\\)', blurb:'Plane waves, polarization bases, and media response.'},
  {id:'e-boundary', title:'Boundaries & Fresnel', domain:'em', method:'theory', href:'em-boundary-fresnel.html', eq:'Fresnel r,t', blurb:'Reflection and transmission at interfaces; design for coatings and fibers.'},
  {id:'e-guides', title:'Waveguides & Cavities', domain:'em', method:'compute', href:'waveguides-cavities.html', eq:'TE/TM cutoffs', blurb:'Geometry picks allowed modes; solve numerically.'},
  {id:'e-radiation', title:'Radiation & Dipoles', domain:'em', method:'theory', href:'radiation-dipole.html', eq:'\\(P\\propto \\ddot{p}^2\\)', blurb:'Far-field patterns, antenna basics, and power scaling.'},

  /* QUANTUM */
  {id:'q-psi', title:'Wavefunction & Norm', domain:'quantum', method:'theory', href:'wavefunction-normalization.html', eq:'\\(\\int |\\Psi|^2 dx=1\\)', blurb:'Probability density, units discipline, and meaning.'},
  {id:'q-sch', title:"Schrödinger Equation", domain:'quantum', method:'theory', href:'schrodinger-equation.html', eq:'\\(i\\hbar\\partial_t\\Psi=[-\\hbar^2\\nabla^2/2m+V]\\Psi\\)', blurb:'Time evolution, stationary states, and boundary quantization.'},
  {id:'q-ops', title:'Operators & Expectation', domain:'quantum', method:'theory', href:'operators-expectation.html', eq:'\\(\\langle A\\rangle=\\langle\\psi|\\hat{A}|\\psi\\rangle\\)', blurb:'Observables as operators; compute averages cleanly.'},
  {id:'q-unc', title:'Commutators & Uncertainty', domain:'quantum', method:'theory', href:'commutators-uncertainty.html', eq:'\\(\\Delta x\\Delta p\\ge\\hbar/2\\)', blurb:'Limits from algebra, not gear sloppiness.'},
  {id:'q-spin', title:'Spin & Pauli', domain:'quantum', method:'theory', href:'spin-pauli.html', eq:'Pauli matrices', blurb:'Two-state lab for measurement sequences and qubits.'},
  {id:'q-super', title:'Superposition & Interference', domain:'quantum', method:'experiment', href:'superposition-interference.html', eq:'\\(|\\Psi_1+\\Psi_2|^2\\)', blurb:'Add amplitudes then square; phase controls fringes.'},
  {id:'q-tunnel', title:'Quantum Tunneling', domain:'quantum', method:'theory', href:'quantum-tunneling.html', eq:'\\(T\\sim e^{-2\\kappa a}\\)', blurb:'Finite chance beyond barriers; trends with width, height, mass.'},
  {id:'q-density', title:'Density Matrix & Decoherence', domain:'quantum', method:'theory', href:'density-matrix-decoherence.html', eq:'\\(\\rho=\\sum p_k|\\psi_k\\rangle\\langle\\psi_k|\\)', blurb:'Open systems, mixtures, and noise.'},
  {id:'q-bell', title:'Entanglement & Bell', domain:'quantum', method:'experiment', href:'entanglement-bell.html', eq:'Bell states', blurb:'Correlations beyond local realism; experiments and implications.'},
  {id:'q-ho', title:'Harmonic Oscillator', domain:'quantum', method:'theory', href:'quantum-harmonic-oscillator.html', eq:'\\(E_n=\\hbar\\omega(n+1/2)\\)', blurb:'Ladder operators and zero-point energy.'},
  {id:'q-box', title:'Particle in a Box', domain:'quantum', method:'compute', href:'particle-in-a-box.html', eq:'\\(E_n\\propto n^2/L^2\\)', blurb:'Nodes, quantization, and simple numerics.'},
  {id:'q-hydrogen', title:'Hydrogen & Angular Momentum', domain:'quantum', method:'theory', href:'hydrogen-atom.html', eq:'Spherical harmonics', blurb:'Degeneracies, selection rules, spectra.'},
  {id:'q-perturb', title:'Perturbation Theory', domain:'quantum', method:'theory', href:'perturbation-theory.html', eq:'\\(E^{(1)}\\)', blurb:'Small changes to solvable systems.'},
  {id:'q-variational', title:'Variational Method', domain:'quantum', method:'compute', href:'variational-method.html', eq:'\\(E[\\phi]\\ge E_0\\)', blurb:'Trial functions upper-bound ground states.'},
  {id:'q-scatter', title:'Scattering & Born Approx', domain:'quantum', method:'theory', href:'scattering-born.html', eq:'Cross sections', blurb:'From potentials to amplitudes; reading differential patterns.'},
  {id:'q-path', title:'Path Integrals (intro)', domain:'quantum', method:'theory', href:'path-integrals-intro.html', eq:'\\(\\int \\mathcal{D}[x] e^{iS/\\hbar}\\)', blurb:'Sum over histories connects action and interference.'},

  /* RELATIVITY */
  {id:'r-lorentz', title:'Lorentz Transformations', domain:'relativity', method:'theory', href:'lorentz-transformations.html', eq:'\\(\\gamma=1/\\sqrt{1-v^2/c^2}\\)', blurb:'Keep light speed fixed; predict time dilation and contraction.'},
  {id:'r-four', title:'Four-Vectors & Invariants', domain:'relativity', method:'theory', href:'four-vectors.html', eq:'\\(p^\\mu=(E/c,\\vec{p})\\)', blurb:'Scalar products that stay the same in all frames.'},
  {id:'r-dynamics', title:'Relativistic Dynamics', domain:'relativity', method:'theory', href:'relativistic-dynamics.html', eq:'\\(E^2=(pc)^2+(mc^2)^2\\)', blurb:'Energy–momentum relations and collisions.'},
  {id:'r-efd', title:'Electrodynamics & Relativity', domain:'relativity', method:'theory', href:'relativistic-electrodynamics.html', eq:'Field tensor \\(F_{\\mu\\nu}\\)', blurb:'Unify E and B; transformations and invariants.'},
  {id:'r-equivalence', title:'Equivalence Principle', domain:'relativity', method:'theory', href:'equivalence-principle.html', eq:'Free fall frames', blurb:'Gravity as geometry; local inertial frames.'},
  {id:'r-geodesic', title:'Geodesics & Curvature', domain:'relativity', method:'compute', href:'geodesics-curvature.html', eq:'\\(\\delta\\int ds=0\\)', blurb:'Motion on curved spacetime; simple metrics.'},
  {id:'r-schwarz', title:'Schwarzschild & Orbits', domain:'relativity', method:'theory', href:'schwarzschild-orbits.html', eq:'\\(r_s=2GM/c^2\\)', blurb:'Horizons, photon spheres, and precession.'},
  {id:'r-gwaves', title:'Gravitational Waves', domain:'relativity', method:'experiment', href:'gravitational-waves.html', eq:'Strain \\(h\\)', blurb:'Ripples from mergers; detectors and signals.'},
  {id:'r-frw', title:'FRW Cosmology', domain:'relativity', method:'theory', href:'frw-cosmology.html', eq:'Friedmann eqs', blurb:'Homogeneous, isotropic expansion models.'},

  /* THERMO & STAT */
  {id:'t-laws', title:'Thermo Laws & State Vars', domain:'thermo', method:'theory', href:'thermo-laws.html', eq:'\\(dU=TdS-PdV+\\mu dN\\)', blurb:'Rules for energy, entropy, and equilibrium.'},
  {id:'t-ensemble', title:'Ensembles & Partition Z', domain:'thermo', method:'theory', href:'ensembles-partition.html', eq:'\\(Z=\\sum e^{-\\beta E_i}\\)', blurb:'Generator for averages and fluctuations.'},
  {id:'t-dists', title:'MB / BE / FD', domain:'thermo', method:'theory', href:'distribution-functions.html', eq:'MB, BE, FD forms', blurb:'Counting rules for gases, bosons, and fermions.'},
  {id:'t-carnot', title:'Engines & Carnot', domain:'thermo', method:'theory', href:'carnot-engines.html', eq:'\\(\\eta=1-T_c/T_h\\)', blurb:'Efficiency limits and cycles.'},
  {id:'t-phase', title:'Phase Transitions', domain:'thermo', method:'experiment', href:'phase-transitions.html', eq:'Order parameters', blurb:'Critical points, exponents, universality.'},
  {id:'t-ising', title:'Ising Model & Monte Carlo', domain:'thermo', method:'compute', href:'ising-montecarlo.html', eq:'\\(H=-J\\sum s_is_j\\)', blurb:'Spin flips, sampling, and emergent order.'},
  {id:'t-fluct', title:'Fluctuation–Dissipation', domain:'thermo', method:'theory', href:'fluctuation-dissipation.html', eq:'Response ↔ noise', blurb:'Link between equilibrium noise and linear response.'},

  /* OPTICS & WAVES */
  {id:'o-wave', title:'Wave Equation & Modes', domain:'optics', method:'theory', href:'wave-equation-modes.html', eq:'\\(\\nabla^2\\psi-(1/v^2)\\partial_t^2\\psi=0\\)', blurb:'Boundaries select discrete shapes and frequencies.'},
  {id:'o-interf', title:'Interference & Diffraction', domain:'optics', method:'experiment', href:'interference-diffraction.html', eq:'\\(\\Delta y\\approx \\lambda L/d\\)', blurb:'Design layouts with simple scaling first.'},
  {id:'o-coherence', title:'Coherence & Sources', domain:'optics', method:'theory', href:'coherence-sources.html', eq:'Visibility \\(V\\)', blurb:'Temporal and spatial coherence control contrast.'},
  {id:'o-fourier', title:'Fourier Optics', domain:'optics', method:'compute', href:'fourier-optics.html', eq:'Fraunhofer FT', blurb:'Lens as Fourier transformer; filtering in frequency space.'},
  {id:'o-fiber', title:'Fiber Optics & Dispersion', domain:'optics', method:'theory', href:'fiber-optics.html', eq:'Group vs phase', blurb:'Guiding, modes, and pulse broadening.'},
  {id:'o-laser', title:'Lasers & Gain', domain:'optics', method:'experiment', href:'lasers-gain.html', eq:'Population inversion', blurb:'Cavities, thresholds, linewidths.'},

  /* CONDENSED MATTER */
  {id:'cm-lattice', title:'Crystal Lattices', domain:'condensed', method:'theory', href:'crystal-lattices.html', eq:'Reciprocal lattice', blurb:'Periodic order and diffraction conditions.'},
  {id:'cm-bz', title:'Brillouin Zones', domain:'condensed', method:'theory', href:'brillouin-zones.html', eq:'Bloch \\(\\psi_{n\\vec{k}}\\)', blurb:'Zone boundaries and scattering.'},
  {id:'cm-band', title:'Band Structure & m*', domain:'condensed', method:'theory', href:'band-structure.html', eq:'\\(m^*=\\hbar^2/(\\partial^2E/\\partial k^2)\\)', blurb:'Curvature sets effective mass and transport.'},
  {id:'cm-semi', title:'Semiconductors', domain:'condensed', method:'theory', href:'semiconductors.html', eq:'Doping & junctions', blurb:'Bands, carriers, devices.'},
  {id:'cm-phonon', title:'Phonons & Heat', domain:'condensed', method:'theory', href:'phonons-heat.html', eq:'Debye model', blurb:'Lattice vibrations and specific heat trends.'},
  {id:'cm-super', title:'Superconductivity (BCS)', domain:'condensed', method:'theory', href:'superconductivity-bcs.html', eq:'Gap \\(\\Delta\\)', blurb:'Cooper pairs, Meissner effect, Josephson links.'},
  {id:'cm-qhe', title:'Quantum Hall & Topology', domain:'condensed', method:'experiment', href:'quantum-hall-topology.html', eq:'\\(R_{xy}=h/\\nu e^2\\)', blurb:'Edge states and plateaus.'},
  {id:'cm-topo', title:'Topological Insulators', domain:'condensed', method:'theory', href:'topological-insulators.html', eq:'Z2 invariants', blurb:'Protected surface states from topology.'},

  /* PARTICLE & FIELD */
  {id:'p-sm', title:'Standard Model', domain:'particle', method:'theory', href:'standard-model.html', eq:'\\(SU(3)\\times SU(2)\\times U(1)\\)', blurb:'Matter & forces organized by gauge symmetry.'},
  {id:'p-higgs', title:'Higgs Mechanism', domain:'particle', method:'theory', href:'higgs-mechanism.html', eq:'Spontaneous breaking', blurb:'Mass generation via symmetry breaking.'},
  {id:'p-feyn', title:'Feynman Diagrams', domain:'particle', method:'theory', href:'feynman-diagrams.html', eq:'Amplitude sum', blurb:'Bookkeeping for contributions, not literal paths.'},
  {id:'p-qed', title:'QED Basics', domain:'particle', method:'theory', href:'qed-basics.html', eq:'Renormalization', blurb:'Light–matter interactions with precision.'},
  {id:'p-qcd', title:'QCD & Confinement', domain:'particle', method:'theory', href:'qcd-confinement.html', eq:'Asymptotic freedom', blurb:'Strong force, color, hadrons.'},
  {id:'p-neutrino', title:'Neutrino Oscillations', domain:'particle', method:'experiment', href:'neutrino-oscillations.html', eq:'\\(P\\sim \\sin^2(1.27\\Delta m^2 L/E)\\)', blurb:'Flavor change signals mass and mixing.'},
  {id:'p-rg', title:'Renormalization Group', domain:'particle', method:'theory', href:'renormalization-group.html', eq:'Running couplings', blurb:'Scale dependence and universality.'},

  /* COSMOLOGY & ASTRO */
  {id:'a-hubble', title:'Hubble Law & Redshift', domain:'cosmo', method:'experiment', href:'hubble-law.html', eq:'\\(v=H_0 d\\)', blurb:'Expansion measured from recession speeds.'},
  {id:'a-friedmann', title:'Friedmann Equations', domain:'cosmo', method:'theory', href:'friedmann-equations.html', eq:'\\((\\dot a/a)^2=\\tfrac{8\\pi G}{3}\\rho-\\tfrac{k}{a^2}+\\tfrac{\\Lambda}{3}\\)', blurb:'Energy budget of the universe.'},
  {id:'a-cmb', title:'Cosmic Microwave Background', domain:'cosmo', method:'experiment', href:'cmb-basics.html', eq:'\\(\\Delta T/T\\)', blurb:'Relic radiation and anisotropies.'},
  {id:'a-bbn', title:'Big Bang Nucleosynthesis', domain:'cosmo', method:'theory', href:'bbn.html', eq:'Light elements', blurb:'Abundances set early conditions.'},
  {id:'a-dark', title:'Dark Matter & Energy', domain:'cosmo', method:'theory', href:'dark-matter-energy.html', eq:'Rotation curves / w', blurb:'Evidence and models.'},
  {id:'a-infl', title:'Inflation & Perturbations', domain:'cosmo', method:'theory', href:'inflation-perturbations.html', eq:'Nearly scale-invariant', blurb:'Rapid early expansion seeds structure.'},
  {id:'a-lensing', title:'Gravitational Lensing', domain:'cosmo', method:'experiment', href:'gravitational-lensing.html', eq:'Deflection angles', blurb:'Map mass with light bending.'},
  {id:'a-compact', title:'Neutron Stars & BHs', domain:'cosmo', method:'theory', href:'compact-objects.html', eq:'EOS / \\(r_s\\)', blurb:'Dense matter, accretion, and signals.'},

  /* METHODS */
  {id:'m-cons', title:'Conservation Laws', domain:'methods', method:'theory', href:'conservation-laws.html', eq:'\\(\\Delta E=0,\\ \\Delta\\vec p=0\\)', blurb:'Choose boundary, then balance.'},
  {id:'m-noether', title:'Noether & Symmetry', domain:'methods', method:'theory', href:'noether-symmetry.html', eq:'time↔energy, space↔momentum', blurb:'Structure that guarantees invariants.'},
  {id:'m-dim', title:'Dimensional Analysis', domain:'methods', method:'theory', href:'dimensional-analysis.html', eq:'Pendulum \\(T\\propto\\sqrt{L/g}\\)', blurb:'Units decide functional form early.'},
  {id:'m-unc-exp', title:'Experimental Uncertainty', domain:'methods', method:'experiment', href:'experimental-uncertainty.html', eq:'\\(\\sigma_{\\bar x}=\\sigma/\\sqrt{N}\\)', blurb:'Report center and spread with honesty.'},
  {id:'m-fft', title:'Fourier Transforms', domain:'methods', method:'compute', href:'fourier-transforms.html', eq:'\\(\\tilde f(k)=\\int f(x)e^{-ikx}dx\\)', blurb:'Think in frequency for clarity.'},
  {id:'m-ode', title:'Numerical ODE Solvers', domain:'methods', method:'compute', href:'numerical-odes.html', eq:'RK / stability', blurb:'Step size and error control matter.'},
  {id:'m-pde', title:'Numerical PDE (FD/FEM)', domain:'methods', method:'compute', href:'numerical-pdes.html', eq:'Grids & BCs', blurb:'Discretize carefully; respect boundaries.'},
  {id:'m-monte', title:'Monte Carlo & Sampling', domain:'methods', method:'compute', href:'monte-carlo.html', eq:'Importance sampling', blurb:'Randomness to integrate and explore.'},
  {id:'m-sch-numerics', title:'1D Schr Numerics', domain:'methods', method:'compute', href:'schrodinger-numerics.html', eq:'Tridiagonal eigens', blurb:'Eigenstates, normalization, split-step.'},
  {id:'m-ml', title:'ML in Physics (overview)', domain:'methods', method:'compute', href:'ml-in-physics.html', eq:'Surrogates / discovery', blurb:'Patterns, surrogates, and hybrid models.'},

  /* METAPHYSICS & PHILOSOPHY */
  {id:'meta-reality', title:'What is “Physical Reality”?', domain:'meta', method:'theory', href:'meta-reality.html', eq:'Ontic vs epistemic', blurb:'Do states describe the world or our information about it?'},
  {id:'meta-causality', title:'Causality & Intervention', domain:'meta', method:'theory', href:'meta-causality.html', eq:'Counterfactuals', blurb:'How do we talk about causes inside closed dynamical laws?'},
  {id:'meta-quantum', title:'Interpretations of Quantum', domain:'meta', method:'theory', href:'meta-quantum-interpretations.html', eq:'Everett / Bohm / GRW', blurb:'Tradeoffs among narratives for the same statistics.'},
  {id:'meta-symmetry', title:'Symmetry & Identity', domain:'meta', method:'theory', href:'meta-symmetry-identity.html', eq:'Indistinguishability', blurb:'When swapping identical things changes nothing, what is individuality?'},
  {id:'meta-laws', title:'Are Laws Descriptive or Prescriptive?', domain:'meta', method:'theory', href:'meta-laws.html', eq:'Humean mosaic', blurb:'Do laws govern or summarize the regularities we observe?'},
  {id:'meta-time', title:'Arrows of Time', domain:'meta', method:'theory', href:'meta-arrow-of-time.html', eq:'Entropy ↑', blurb:'Why do macroscopic processes have direction if equations are reversible?'}
];

/* Containers and counts */
const containers = {
  classical: document.querySelector('#sec-classical .grid'),
  em:        document.querySelector('#sec-em .grid'),
  quantum:   document.querySelector('#sec-quantum .grid'),
  relativity:document.querySelector('#sec-relativity .grid'),
  thermo:    document.querySelector('#sec-thermo .grid'),
  optics:    document.querySelector('#sec-optics .grid'),
  condensed: document.querySelector('#sec-condensed .grid'),
  particle:  document.querySelector('#sec-particle .grid'),
  cosmo:     document.querySelector('#sec-cosmo .grid'),
  methods:   document.querySelector('#sec-methods .grid'),
  meta:      document.querySelector('#sec-meta .grid')
};
const counts = {
  classical: document.getElementById('cnt-classical'),
  em:        document.getElementById('cnt-em'),
  quantum:   document.getElementById('cnt-quantum'),
  relativity:document.getElementById('cnt-relativity'),
  thermo:    document.getElementById('cnt-thermo'),
  optics:    document.getElementById('cnt-optics'),
  condensed: document.getElementById('cnt-condensed'),
  particle:  document.getElementById('cnt-particle'),
  cosmo:     document.getElementById('cnt-cosmo'),
  methods:   document.getElementById('cnt-methods'),
  meta:      document.getElementById('cnt-meta')
};

function cardHTML(item){
  const fav = new Set(loadFav());
  const methodTag = item.method==='theory' ? 'Theory' : item.method==='experiment' ? 'Experiment' : 'Computation';
  return `
  <div class="card" data-letter="${item.title.trim()[0].toUpperCase()}" data-id="${item.id}">
    <button class="star ${fav.has(item.id)?'active':''}" title="Pin">★</button>
    <h4>${item.title}</h4>
    <div class="meta"><span class="tag">${methodTag}</span>${item.domain==='methods'?'<span class="tag alt">Cross-cutting</span>':''}</div>
    <p>${item.blurb}</p>
    <div class="eq">${item.eq}</div>
    <div class="links"><a href="${item.href}">Open article →</a></div>
  </div>`;
}

function render(){
  let list = data.filter(d=>{
    const domOK = (activeDomain==='all') || (d.domain===activeDomain);
    const metOK = (activeMethod==='any') || (d.method===activeMethod);
    const qOK = !query || (d.title.toLowerCase().includes(query) || d.blurb.toLowerCase().includes(query));
    return domOK && metOK && qOK;
  });

  Object.values(containers).forEach(c=>c.innerHTML='');
  const letterSet = new Set();

  list.forEach(item=>{
    const c = containers[item.domain] || containers.methods;
    if(c){ c.insertAdjacentHTML('beforeend', cardHTML(item)); letterSet.add(item.title.trim()[0].toUpperCase()); }
  });

  const byDom = {}; list.forEach(i=>{ byDom[i.domain]=(byDom[i.domain]||0)+1; });
  Object.keys(counts).forEach(k=> counts[k].textContent = (byDom[k]||0)+' items');

  document.getElementById('countLine').textContent = `Showing ${list.length} of ${data.length} concepts`;
  makeAlphaButtons(letterSet);

  document.querySelectorAll('.card .star').forEach(btn=>{
    btn.onclick=()=>{
      const id = btn.closest('.card').dataset.id;
      const fav = new Set(loadFav());
      if(fav.has(id)){ fav.delete(id); btn.classList.remove('active'); }
      else { fav.add(id); btn.classList.add('active'); }
      saveFav([...fav]); renderFavLinks();
    };
  });
}
render(); renderFavLinks(); renderNotes();

/* Generate full A–Z on load too */
makeAlphaButtons(new Set(data.map(d=>d.title.trim()[0].toUpperCase())));

/* Smooth scroll to a section when picking a domain */
domainPills.querySelectorAll('.pill').forEach(p=>{
  p.addEventListener('click',()=>{
    const d=p.dataset.domain; if(d==='all') return;
    const sec=document.getElementById('sec-'+d); if(sec) sec.scrollIntoView({behavior:'smooth', block:'start'});
  });
});
</script>
</body>
</html>
