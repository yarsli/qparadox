<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QParadox • Quantum Next</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"/>

<style>
:root{
  --bg:#0b0b0d; --panel:#131316; --ink:#efeae2; --ink2:#d8d1c8; --muted:#b9b3aa;
  --gold:#caa36b; --blue:#7aa0ff; --line:rgba(255,255,255,.14); --glass:rgba(255,255,255,.06);
  --shadow:0 18px 60px rgba(0,0,0,.72), inset 0 0 120px rgba(255,255,255,.03);
  --radius:18px; --max:1180px; --side:330px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:"Crimson Text",serif; line-height:1.95; letter-spacing:.15px; overflow-x:hidden;
}
body::before{content:""; position:fixed; inset:0; z-index:-3; opacity:.06;
  background:url('https://www.transparenttextures.com/patterns/asfalt-dark.png')}
body::after{content:""; position:fixed; inset:0; z-index:-2;
  background:
    radial-gradient(900px 520px at 12% 0%, rgba(255,222,180,.09), transparent 60%),
    radial-gradient(900px 520px at 88% 12%, rgba(140,160,255,.06), transparent 60%),
    radial-gradient(1000px 620px at 50% 100%, rgba(202,163,107,.07), transparent 70%)}

.frame{position:fixed; inset:18px; border:1px solid var(--line); border-radius:22px; pointer-events:none; box-shadow:inset 0 0 140px rgba(0,0,0,.45)}
#progress{position:fixed; top:0; left:0; height:4px; width:0; z-index:100; background:linear-gradient(90deg,var(--gold),var(--blue))}

header{padding:6.2rem 1.2rem 2.4rem; text-align:center}
h1{font-family:"Playfair Display",serif; font-weight:900; margin:0; font-size:clamp(2.6rem,4vw,4.8rem); line-height:1.1; color:#f5ead8}
.subtitle{max-width:980px; margin:1rem auto 0; color:var(--ink2); font-size:clamp(1.05rem,1.2vw,1.2rem)}

.main{width:min(1200px,94%); margin:0 auto 4rem; display:grid; grid-template-columns:1fr; gap:26px}
@media(min-width:1120px){ .main{grid-template-columns:minmax(0, 1fr) var(--side)} }

article{
  background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:2.6rem 2.2rem
}
article h2{font-family:"Playfair Display",serif; margin:2rem 0 1rem; font-size:clamp(1.85rem,2.6vw,2.5rem); color:#f6eddc}
.divider{height:1px; background:linear-gradient(90deg,transparent,var(--line),transparent); margin:1.2rem 0}
p{margin:1.05rem 0; text-align:justify}
.dropcap:first-letter{float:left; font-family:"Playfair Display",serif; font-size:3.2rem; line-height:2.3rem; padding:.25rem .5rem .2rem 0; color:#f3e4c5}

/* callouts */
.call{border:1px solid var(--line); border-radius:12px; background:rgba(255,255,255,.05); padding:.85rem .9rem; color:var(--ink2); margin:1rem 0}

/* figures */
.figure{margin:1.5rem auto; border:1px solid var(--line); border-radius:14px; overflow:hidden; background:#0e0f12; box-shadow:var(--shadow); max-width:820px}
.figure img{display:block; width:100%; height:auto}
.figcap{padding:.7rem .9rem; color:var(--ink2); font-size:.95rem; border-top:1px solid var(--line)}

/* paragraph highlight button */
.pwrap{position:relative; padding-right:2.5rem}
.hlbtn{
  position:absolute; right:.2rem; top:.35rem; padding:.25rem .6rem; border-radius:.6rem;
  background:var(--glass); color:var(--ink); border:1px solid var(--line);
  font-size:.85rem; cursor:pointer; opacity:0; transition:.2s
}
.pwrap:hover .hlbtn{opacity:1}
.mark{background:linear-gradient(180deg, rgba(202,163,107,.3), rgba(122,160,255,.24)); border-radius:.2rem; padding:.05rem .12rem}

/* collapsible worked examples */
details{border:1px solid var(--line); border-radius:12px; padding:.7rem .9rem; background:rgba(255,255,255,.04); margin:1rem 0}
details summary{cursor:pointer; font-family:"Playfair Display",serif; font-size:1.15rem; outline:none}

/* sidebar */
aside{
  position:sticky; top:90px; align-self:start; height:fit-content;
  background:linear-gradient(180deg,rgba(255,255,255,.055),rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); padding:1rem .9rem
}
aside h3{margin:.2rem 0 .7rem; font-family:"Playfair Display",serif}
.toc a{display:block; text-decoration:none; color:var(--ink2); padding:.35rem .2rem; border-radius:.4rem; font-size:.95rem}
.toc a:hover{color:var(--ink)}
.toc a.active{color:#111; background:linear-gradient(90deg,var(--gold),#efd6a8)}
hr.sep{border:0; height:1px; background:linear-gradient(90deg,transparent,var(--line),transparent); margin:1rem 0}
.note{border:1px solid var(--line); border-radius:12px; padding:.7rem .75rem; margin:.5rem 0; background:rgba(255,255,255,.05)}
.note time{display:block; color:var(--muted); font-size:.85rem}
.note .del{margin-top:.4rem; padding:.25rem .55rem; border-radius:.5rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer}

/* quiz */
.quiz{margin-top:1.6rem; padding:1rem; border:1px solid var(--line); border-radius:14px; background:rgba(255,255,255,.04)}
.qitem{margin:1rem 0; padding:.8rem; border-radius:10px; border:1px solid rgba(255,255,255,.12)}
.qitem h4{margin:0 0 .5rem 0; font-family:"Playfair Display",serif}
.qchoices{display:grid; gap:.45rem}
.qchoices button{text-align:left; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.05); color:var(--ink); padding:.55rem .7rem; border-radius:.6rem; cursor:pointer}
.qchoices button.correct{border-color:#46d17d}
.qchoices button.wrong{border-color:#e07070}
.qfeedback{color:var(--ink2); margin-top:.4rem; font-size:.98rem}

/* nav links */
.nextrow{display:flex; gap:.6rem; flex-wrap:wrap; margin-top:1.3rem}
.nextrow a{text-decoration:none; color:var(--ink); border:1px solid rgba(255,255,255,.26); border-radius:.8rem; background:linear-gradient(90deg,rgba(202,163,107,.28),rgba(122,160,255,.22)); padding:.7rem 1rem}

/* reveal + footer */
.reveal{opacity:0; transform:translateY(24px); transition:opacity .9s, transform .9s}
.reveal.in{opacity:1; transform:none}
footer{padding:2rem 1rem; text-align:center; color:var(--muted); border-top:1px solid var(--line)}
</style>
</head>
<body>

<div class="frame" aria-hidden="true"></div>
<div id="progress"></div>

<header class="reveal in">
  <h1>Quantum Next</h1>
  <p class="subtitle">A calm step beyond the Toolkit — start simple, secure the rules, then add depth with examples, tidy equations, and checks you can repeat.</p>
</header>

<div class="main">
  <article id="article">

    <figure class="figure reveal">
      <img src="equation-cool.jpg" alt="Equations aesthetic"/>
      <figcaption class="figcap">Write the idea, choose the rule, do the check. The habit matters more than any one formula.</figcaption>
    </figure>

    <!-- ORIENTATION -->
    <h2 id="orientation" class="reveal">Orientation</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q1">★ Highlight</button>
      <p id="q1" class="dropcap">
        This page extends the Quantum Toolkit without rushing the math. We begin with pictures and plain-language rules, then add one equation at a time and practice using it. The aim is to get comfortable setting up a quantum problem the same way each time. You state the system and the question, you select the clean rule that ties them together, and you check the answer in a limit where your intuition is strong. Doing this slowly builds a sense that hard-looking problems are just longer versions of moves you already know.
      </p>
    </div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q2">★ Highlight</button>
      <p id="q2">
        Keep a short checklist in the margin. What is the state and how is it written. Which operator or conservation idea matters here. What is the simplest limit where you expect the behavior. If your final line does not respect units or the easy limit, pause and repair before pushing on. These small habits are what make theory feel steady rather than fragile.
      </p>
    </div>

    <!-- PROBABILITY BASICS -->
    <h2 id="prob" class="reveal">Probability from the wave picture</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q3">★ Highlight</button>
      <p id="q3" class="dropcap">
        The wave function \( \Psi(x,t) \) is the tool for predictions. The square of its size is a probability density and the total must be one:
        \[
          P(x,t)=|\Psi(x,t)|^2, \qquad \int_{-\infty}^{\infty} |\Psi(x,t)|^2\,dx = 1.
        \]
        Read these as instructions. Compute the shape, square it, and normalize. If a result later seems odd, come back to this step first because many mistakes begin with a missing factor or a drifted normalization.
      </p>
    </div>

    <details class="reveal"><summary>Worked example — two overlapping bumps</summary>
      <p>
        Build a state from two narrow Gaussians centered at \(-a\) and \(+a\). If the relative phase is the same, the middle region brightens. If the phase is opposite, a notch appears between the peaks. If the phase wanders from trial to trial, the cross term averages away and you see a simple sum. One plot shows how phase is not decoration but the control knob for interference.
      </p>
    </details>

    <!-- TIME EVOLUTION -->
    <h2 id="time" class="reveal">Time evolution without panic</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q4">★ Highlight</button>
      <p id="q4" class="dropcap">
        The time rule looks compact:
        \[
          i\hbar\,\frac{\partial}{\partial t}\Psi(x,t) = \hat{H}\,\Psi(x,t).
        \]
        Many useful cases separate in time and space when the potential does not change in time. Try \(\Psi(x,t)=\phi(x)\,e^{-iEt/\hbar}\). The space function \(\phi(x)\) then satisfies a quieter standing-wave equation. You do not need a closed-form solution to learn something. Describe the boundary, sketch the likely nodes, and predict how energy shifts when a parameter grows or shrinks. The sign of each change often falls out before any long algebra.
      </p>
    </div>

    <details class="reveal"><summary>Worked example — particle in a one-dimensional box</summary>
      <p>
        Inside the box the solutions are sines that fit an integer number of half-waves. The energies
        \[
          E_n = \frac{n^2\pi^2\hbar^2}{2mL^2}, \quad n=1,2,\dots
        \]
        pass two quick checks. If you make the box longer, levels crowd closer, which matches the idea of a gentler standing wave. If you use a heavier particle, every level drops because heavier masses are harder to wiggle. When a formula respects these trends, trust grows.
      </p>
    </details>

    <!-- UNCERTAINTY -->
    <h2 id="unc" class="reveal">Uncertainty as a design choice</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q5">★ Highlight</button>
      <p id="q5" class="dropcap">
        The spread in position and momentum is structural, not an equipment flaw. The compact limit
        \[
          \Delta x\,\Delta p \ge \frac{\hbar}{2}
        \]
        tells you how one knob widens when you narrow the other. A tight beam spot implies a wide momentum spread and faster spreading as time passes. A colder cloud has a narrower momentum spread and drifts more slowly. Use the relation to plan, not to worry.
      </p>
    </div>

    <!-- INTERFERENCE -->
    <h2 id="phase" class="reveal">Interference and the role of phase</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q6">★ Highlight</button>
      <p id="q6" class="dropcap">
        When two paths remain undisturbed their amplitudes add before you square. The cross term carries the relative phase. Small changes in path length, refractive index, or potential add up to visible shifts in the pattern. This is why careful phase control is the key to precision interferometry and also why stray coupling to the environment washes patterns away. The idea is simple: keep what you do not want to measure from learning which way the system went.
      </p>
    </div>

    <!-- TUNNELING -->
    <h2 id="tunnel" class="reveal">Barriers, leakage, and tunneling</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q7">★ Highlight</button>
      <p id="q7" class="dropcap">
        Classically a wall that is higher than your energy is a hard stop. Quantum mechanics allows a small chance to appear beyond the wall, especially if the barrier is thin or the particle is light. Inside the wall the wave decays but survives. At the far edge a faint tail emerges. The trend is enough to understand tunneling diodes, scanning microscopes, and nuclear alpha emission without memorizing long formulas.
      </p>
    </div>

    <!-- SPIN -->
    <h2 id="spin" class="reveal">Spin as a clean two-state system</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q8">★ Highlight</button>
      <p id="q8" class="dropcap">
        Spin is an intrinsic two-level structure that behaves like a vector of operators. The Stern–Gerlach chain teaches three repeatable facts. First, outcomes can be discrete even when inputs look smooth. Second, measuring along a new axis scrambles certainty from the old axis. Third, repeating the same axis restores predictability. Those three lines already let you reason about qubits and the Bloch sphere with confidence.
      </p>
    </div>

    <!-- EXPECTATION -->
    <h2 id="expect" class="reveal">Expectation values in one line</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q9">★ Highlight</button>
      <p id="q9" class="dropcap">
        The average result from many runs is
        \[
          \langle A \rangle = \int \Psi^*(x,t)\,\hat{A}\,\Psi(x,t)\,dx.
        \]
        In bra–ket language the same idea is \( \langle \psi | \hat{A} | \psi \rangle \). One advantage of the compact form is that units and symmetry are easier to inspect. If a proposed operator would make the units wrong, you catch it before a page of algebra.
      </p>
    </div>

    <!-- ENTANGLEMENT -->
    <h2 id="ent" class="reveal">Entanglement without mystique</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q10">★ Highlight</button>
      <p id="q10" class="dropcap">
        Some states resist separation. A simple two-qubit case is
        \[
          \frac{1}{\sqrt{2}}\big(|00\rangle + |11\rangle\big).
        \]
        No product of a state of A and a state of B can reproduce its perfect correlations. This is not a signal racing ahead of light. It is a structure set at preparation and revealed by which questions you ask. The safe habit is to think of the whole first, then describe parts by tracing over what you ignore.
      </p>
    </div>

    <figure class="figure reveal">
      <img src="quantum-atom.jpg" alt="Quantum atom visual"/>
      <figcaption class="figcap">Some predictions only make sense when you treat the pair as one system.</figcaption>
    </figure>

    <!-- MEASUREMENT + DECOHERENCE -->
    <h2 id="meas" class="reveal">Measurement and why interference fades</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q11">★ Highlight</button>
      <p id="q11" class="dropcap">
        Projective measurements are the sharp ideal: outcomes line up with the eigenvectors of an operator. Real setups often leak information to the surroundings. When the environment keeps a reliable record of which path was taken, the off-diagonal terms of the reduced density description shrink and the contrast of fringes falls. You did not break any rule. You changed the conditions for phases to add. The lesson for the lab is practical. Isolation and speed preserve interference. Coupling erases it.
      </p>
    </div>

    <!-- APPLICATIONS -->
    <h2 id="apps" class="reveal">From rules to devices</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q12">★ Highlight</button>
      <p id="q12" class="dropcap">
        The same ideas drive real tools. Band structure in crystals is a standing wave story and explains semiconductors. Coherent emission between energy levels makes lasers. Resonant control of spin in fields makes MRI. Quantum sensors stretch uncertainty in one quantity while relaxing it in another to make tiny effects visible. None of this needs drama. It is careful use of a small kit: amplitude, phase, operators, and checks.
      </p>
    </div>

    <figure class="figure reveal">
      <img src="work.jpeg" alt="Desk with notebooks and lamp"/>
      <figcaption class="figcap">Write assumptions beside each result. Future you will know what to trust and what to revisit.</figcaption>
    </figure>

    <!-- PRACTICE PROMPTS -->
    <h2 id="practice" class="reveal">Practice prompts</h2>
    <div class="divider"></div>

    <div class="pwrap reveal">
      <button class="hlbtn" data-target="q13">★ Highlight</button>
      <p id="q13" class="dropcap">
        One page each. Normalize a Gaussian and compute its width, then predict how the width evolves for free motion. Sketch the first three standing waves in a box and explain why the second has a node at the center. Estimate how tunneling chance changes when you double barrier thickness while keeping mass and kinetic energy fixed. Model a Stern–Gerlach chain with the middle magnet rotated and predict the three output spots. Compute an expectation value two ways to confirm comfort with both integral and bra–ket forms.
      </p>
    </div>

    <!-- QUIZ -->
    <h2 id="quiz" class="reveal">Short quiz</h2>
    <div class="divider"></div>

    <section class="quiz reveal" id="quizSection">
      <div class="qitem">
        <h4>1) The meaning of \( |\Psi(x,t)|^2 \) is</h4>
        <div class="qchoices" data-answer="b" data-explain="It is a probability density; integrate over a region to get the chance to find the particle there.">
          <button data-choice="a">Energy density at x</button>
          <button data-choice="b">Probability density at x</button>
          <button data-choice="c">Momentum distribution</button>
        </div><div class="qfeedback"></div>
      </div>

      <div class="qitem">
        <h4>2) With a time-independent potential a good first move is</h4>
        <div class="qchoices" data-answer="a" data-explain="Try a separable form, which turns time evolution into a simple phase.">
          <button data-choice="a">\(\Psi(x,t)=\phi(x)e^{-iEt/\hbar}\)</button>
          <button data-choice="b">Assume energy grows with time</button>
          <button data-choice="c">Ignore boundary conditions</button>
        </div><div class="qfeedback"></div>
      </div>

      <div class="qitem">
        <h4>3) The uncertainty relation teaches that</h4>
        <div class="qchoices" data-answer="c" data-explain="Tight position control forces a wider momentum spread.">
          <button data-choice="a">Better tools remove all spread</button>
          <button data-choice="b">Only momentum is uncertain</button>
          <button data-choice="c">Narrowing Δx widens Δp</button>
        </div><div class="qfeedback"></div>
      </div>

      <div class="qitem">
        <h4>4) A fast check on box energies is</h4>
        <div class="qchoices" data-answer="b" data-explain="As L grows, levels compress. If your expression misses that, recheck your algebra.">
          <button data-choice="a">Make mass smaller to lower energies</button>
          <button data-choice="b">Let L grow and see levels move closer</button>
          <button data-choice="c">Ignore units and compare shapes</button>
        </div><div class="qfeedback"></div>
      </div>

      <div class="qitem">
        <h4>5) An entangled two-qubit state is one that</h4>
        <div class="qchoices" data-answer="a" data-explain="It cannot be written as a simple product of a state of A and a state of B.">
          <button data-choice="a">Does not factor into product states</button>
          <button data-choice="b">Always yields equal outcomes</button>
          <button data-choice="c">Has zero probability everywhere</button>
        </div><div class="qfeedback"></div>
      </div>

      <div style="margin-top:.8rem">
        <button id="gradeBtn" style="border:1px solid rgba(255,255,255,.3); background:rgba(255,255,255,.08); color:var(--ink); padding:.6rem 1rem; border-radius:.6rem; cursor:pointer">Grade quiz</button>
        <span id="scoreLine" style="margin-left:.8rem; color:var(--ink2)"></span>
      </div>
    </section>

    <div class="nextrow reveal">
      <a href="quantum_toolkit.html">← Back to Quantum Toolkit</a>
      <a href="quantum_experiments.html">Next: Quantum Experiments →</a>
    </div>

  </article>

  <aside class="reveal">
    <h3>Contents</h3>
    <div id="toc" class="toc"></div>
    <hr class="sep"/>

    <h3>Notebook</h3>
    <p style="color:var(--ink2); margin:.1rem 0 .6rem">Click ★ next to any paragraph to save it here. Add your own note below.</p>
    <div id="nbList"></div>

    <textarea id="freeNote" placeholder="Write your own note. Press Save to store it." style="margin-top:.6rem; height:100px; background:rgba(255,255,255,.05); border:1px solid var(--line); color:var(--ink); border-radius:.5rem; padding:.55rem .6rem; font-family:'Crimson Text',serif;"></textarea>
    <div style="display:flex; gap:.5rem; margin-top:.4rem">
      <button id="saveFree" style="padding:.45rem .7rem; border-radius:.6rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer">Save</button>
      <button id="clearAll" style="padding:.45rem .7rem; border-radius:.6rem; border:1px solid var(--line); background:var(--glass); color:var(--ink); cursor:pointer">Clear all</button>
    </div>
    <p style="color:var(--muted); font-size:.9rem; margin-top:.4rem">Notes are saved in this browser.</p>

    <hr class="sep"/>
    <figure class="figure">
      <img src="work.jpeg" alt="Desk with notebooks and lamp"/>
      <figcaption class="figcap">Keep a compact log of assumptions and units next to each result.</figcaption>
    </figure>
  </aside>
</div>

<footer>© 2025 QParadox</footer>

<script>
/* progress bar */
const bar=document.getElementById('progress');
function onScroll(){
  const h=document.documentElement, st=h.scrollTop||document.body.scrollTop, sh=h.scrollHeight-h.clientHeight;
  bar.style.width=(Math.max(0,Math.min(1,st/sh))*100)+'%';
}
addEventListener('scroll', onScroll); onScroll();

/* reveal */
const obs=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('in'); obs.unobserve(e.target);} }); },{threshold:.18});
document.querySelectorAll('.reveal').forEach(el=>{ if(!el.classList.contains('in')) obs.observe(el); });

/* TOC */
const toc=document.getElementById('toc');
const heads=[...document.querySelectorAll('#article h2')];
heads.forEach(h=>{ const a=document.createElement('a'); a.href='#'+h.id; a.textContent=h.textContent; toc.appendChild(a); });
function spy(){
  const y=scrollY+140; let idx=-1;
  heads.forEach((s,i)=>{ if(s.offsetTop<=y && s.offsetTop+s.offsetHeight>y) idx=i; });
  [...toc.querySelectorAll('a')].forEach((a,i)=>a.classList.toggle('active',i===idx));
}
addEventListener('scroll', spy); spy();

/* notebook store - unique key for this page */
const KEY='qpx_notes_quantum_next_v1';
const listEl=document.getElementById('nbList');
function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]');}catch(e){return [];} }
function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }
function render(){
  const notes=load(); listEl.innerHTML='';
  if(notes.length===0){ listEl.innerHTML='<p style="color:var(--muted)">No notes yet.</p>'; return; }
  notes.forEach(n=>{
    const div=document.createElement('div'); div.className='note'; div.dataset.id=n.id;
    div.innerHTML=`<time>${new Date(n.time).toLocaleString()}</time>
      <p>${n.text}</p>
      <button class="del">Remove</button>`;
    listEl.appendChild(div);
  });
}
render();

/* paragraph highlight save */
document.querySelectorAll('.hlbtn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id=btn.dataset.target, p=document.getElementById(id);
    if(!p) return;
    p.classList.add('mark');
    const notes=load(); notes.push({id:'n'+Date.now(), text:p.textContent.trim(), time:Date.now(), para:id});
    save(notes); render();
  });
});

/* free note save & clear */
document.getElementById('saveFree').addEventListener('click',()=>{
  const box=document.getElementById('freeNote'); const t=box.value.trim(); if(!t) return;
  const notes=load(); notes.push({id:'n'+Date.now(), text:t, time:Date.now(), para:null});
  save(notes); render(); box.value='';
});
listEl.addEventListener('click',e=>{
  if(!e.target.classList.contains('del')) return;
  const item=e.target.closest('.note'); const id=item.dataset.id;
  const notes=load().filter(x=>x.id!==id); save(notes); render();
});
document.getElementById('clearAll').addEventListener('click',()=>{
  if(!confirm('Clear all saved notes for this page')) return;
  localStorage.removeItem(KEY); render();
  document.querySelectorAll('.mark').forEach(m=>m.classList.remove('mark'));
});

/* quiz grading */
const gradeBtn=document.getElementById('gradeBtn');
if(gradeBtn){
  document.querySelectorAll('.qchoices button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const group=btn.closest('.qchoices');
      group.querySelectorAll('button').forEach(b=>{ b.dataset.pressed='0'; b.classList.remove('correct','wrong'); });
      btn.dataset.pressed='1';
      const fb=group.parentElement.querySelector('.qfeedback');
      fb.textContent='Selection saved. Press Grade quiz when ready.';
      fb.style.color='#d1d1d1';
    });
  });
  gradeBtn.addEventListener('click',()=>{
    let score=0, total=0;
    document.querySelectorAll('.qchoices').forEach(group=>{
      total++;
      const ans=group.dataset.answer;
      const explain=group.dataset.explain||'';
      const fb=group.parentElement.querySelector('.qfeedback');
      const choice=[...group.querySelectorAll('button')].find(b=>b.dataset.pressed==='1');
      if(!choice){
        fb.textContent='Select an option to see feedback.'; fb.style.color='#f0d28a'; return;
      }
      if(choice.dataset.choice===ans){
        score++; choice.classList.add('correct'); fb.textContent='Correct — ' + explain; fb.style.color='#8fe0a8';
      }else{
        choice.classList.add('wrong'); fb.textContent='Not quite — ' + explain; fb.style.color='#f29b9b';
        const corr=[...group.querySelectorAll('button')].find(b=>b.dataset.choice===ans);
        if(corr) corr.classList.add('correct');
      }
    });
    const scoreLine=document.getElementById('scoreLine');
    if(scoreLine) scoreLine.textContent='Score: ' + score + ' / ' + total;
  });
}
</script>
</body>
</html>
